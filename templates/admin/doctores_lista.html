{% extends "base.html" %}

{% block title %}Administrar Doctores{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2><i class="fas fa-users-cog me-2"></i>Gestionar Doctores</h2>
        <div>
            <a href="{{ url_for('admin.admin_create_doctor') }}" class="btn btn-success btn-sm">
                <i class="fas fa-user-plus me-1"></i> Registrar Nuevo Doctor
            </a>
            <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-outline-secondary btn-sm ms-2">
                <i class="fas fa-arrow-left me-1"></i> Volver al Dashboard Admin
            </a>
        </div> 
    </div>
    <hr>


    {% if doctores %}
    <div class="table-responsive">
        <table class="table table-striped table-hover table-sm">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Nombre Completo</th>
                    <th>Usuario</th>
                    <th>Rol</th>
                    <th>Estado</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for dr_item in doctores %} {# Cambiado 'dr' a 'dr_item' para evitar conflicto si 'dr' está en el contexto global #}
                <tr>
                    <td>{{ dr_item.id_dr }}</td>
                    <td>{{ dr_item.nombre }}</td>
                    <td>{{ dr_item.usuario }}</td>
                    <td>
                        {% if dr_item.is_admin_role %}
                            <span class="badge bg-info">Administrador</span>
                        {% else %}
                            <span class="badge bg-secondary">Doctor</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if dr_item.esta_activo %}
                            <span class="badge bg-success">Activo</span>
                        {% else %}
                            <span class="badge bg-danger">Inactivo</span>
                        {% endif %}
                    </td>
                    <td class="text-center">
                        <a href="{{ url_for('admin.admin_edit_doctor', id_dr=dr_item.id_dr) }}" class="btn btn-primary btn-sm" title="Editar Doctor">
                            <i class="fas fa-user-edit"></i>
                        </a>
                        <a href="{{ url_for('admin.admin_change_doctor_password', id_dr=dr_item.id_dr) }}" class="btn btn-secondary btn-sm" title="Cambiar Contraseña">
                            <i class="fas fa-key"></i>
                        </a>
                        <form action="{{ url_for('admin.admin_toggle_doctor_status', id_dr=dr_item.id_dr) }}" method="POST" class="d-inline" onsubmit="return confirm('¿Estás seguro de cambiar el estado de este doctor?');">
                            {# {{ csrf_token() }} #} {# Comentado por ahora, añadir si CSRF global está activo #}
                            {% if dr_item.esta_activo %}
                                <button type="submit" class="btn btn-warning btn-sm" title="Deshabilitar Doctor">
                                    <i class="fas fa-user-slash"></i>
                                </button>
                            {% else %}
                                <button type="submit" class="btn btn-info btn-sm" title="Habilitar Doctor">
                                    <i class="fas fa-user-check"></i>
                                </button>
                            {% endif %}
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info">No hay doctores registrados (aparte de usted, si es el primer admin). Use "Registrar Nuevo Doctor".</div>
    {% endif %}
</div>
{% endblock %}