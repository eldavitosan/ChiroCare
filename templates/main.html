{% extends 'base.html' %}
{% block title %}Home - Chiropractic Care Cuautitlan{% endblock %}

{% block head_extra %}
<style>
    
</style>
{% endblock %}

{% block content %}

    <div id="active-patient-display" class="text-center">
        <button id="clear-selection-button" class="btn btn-sm btn-warning mt-1 hidden">Limpiar Selección</button>
    </div>

    <div class="row text-center gy-4 mb-5 justify-content-center"> {# Añadido justify-content-center #}
        <div class="col-md-6 col-lg-3"> {# Ocupa espacio como antes, centrado #}
             <a href="{{ url_for('patient.add_patient_route') }}" class="card shadow-sm dashboard-button text-decoration-none d-block"> <div class="card-body">
                 <div class="icon"><i class="fas fa-user-plus fa-3x icon-enabled"></i></div>
                 <h5 class="card-title mt-2">Paciente Nuevo</h5>
                 </div>
            </a>
            <a href="{{ url_for('resumen_dia_anterior') }}" class="btn btn-outline-secondary mt-3">
                <i class="fas fa-history me-2"></i> Ver Resumen del Día Anterior
            </a>
        </div>
        {# Los otros 3 botones (Examenes, Plan, Seguimiento) han sido eliminados #}
    </div> <div id="search-section" class="row justify-content-center mt-4 mb-4">
        <div class="col-md-8 col-lg-6">
            <div class="input-group">
                <input type="search" id="patient-search-input" class="form-control" placeholder="Buscar paciente por nombre o apellido..." aria-label="Buscar paciente">
                <button class="btn btn-outline-secondary" type="button" id="patient-search-button">Buscar</button>
            </div>
        </div>
    </div>
    <div class="row justify-content-center mt-4 mb-5">
         <div class="col-md-10 col-lg-8">
             <div id="search-results-container">
                 {# --- CAMBIO EN EL TEXTO DEL LABEL --- #}
                 <label class="form-label" id="search-results-label">Pacientes con Seguimiento Reciente:</label>
                 {# ----------------------------------- #}
                 <div id="search-results">
                     {# Contenido inicial: Lista de Pacientes #}
                     {% if recent_patients %}
                        <div class="list-group list-group-flush">
                            {% for patient in recent_patients %}
                            <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center patient-result-item initial-patient"
                                 data-patient-id="{{ patient.id_px }}"
                                 data-patient-name="{{ patient.nombre }} {{ patient.apellidop }} {{ patient.apellidom or '' }}">
                                <span>
                                     <i class="fas fa-user-clock me-2 text-secondary"></i> {# Icono opcional cambiado #}
                                    {{ patient.nombre }} {{ patient.apellidop }} {{ patient.apellidom or '' }}
                                    {# Opcional: Mostrar la fecha del último seguimiento #}
                                    {% if patient.fecha_ultimo_seguimiento %}
                                        <small class="text-muted ms-2">(&Uacute;lt. Seg.: {{ patient.fecha_ultimo_seguimiento or 'N/A' }})</small>
                                    {% endif %}
                                </span>
                                <a href="{{ url_for('patient.patient_detail', patient_id=patient.id_px) }}" class="btn btn-sm btn-outline-primary detail-link">Ver Detalle</a>
                            </div>
                            {% endfor %}
                        </div>
                     {% else %}
                        {# El flash message de main.py ya debería cubrir esto, pero por si acaso #}
                        <p class="text-muted p-2">No hay pacientes con seguimientos recientes para mostrar.</p>
                     {% endif %}
                 </div>
             </div>
         </div>
    </div>
     {% endblock %} {# FIN del bloque content #}


     {% block scripts %}
     {{ super() }}
     <script>
         document.addEventListener('DOMContentLoaded', function() {
             initializePatientSearch(
                 'patient-search-input',
                 'patient-search-button',
                 'search-results',
                 'search-results-container',
                 'active-patient-display',
                 'clear-selection-button',
                 'search-results-label' // Añadido ID del label
             );
         });
     </script>
     {% endblock %}